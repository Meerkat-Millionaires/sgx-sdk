# Switchboard Attestation Process

Switchboard Attestation Program is designed to ensure the security and trustworthiness of SGX enclaves within the context of oracle applications. This document provides an overview of the Switchboard attestation process and its significance in creating a secure and reliable environment for developers to build decentralized applications.

## Introduction to SGX Attestation

Intel Software Guard Extensions (SGX) is a technology that provides a secure execution environment called an enclave, where sensitive code and data can be protected from unauthorized access or tampering. To ensure the authenticity and integrity of the enclaves, the attestation process verifies the enclave's identity and validates its code and data.

Switchboard Attestation Program leverages SGX attestation to establish trust in the oracle applications, providing a robust mechanism for verifying the secure execution of code within the Trusted Execution Environment (TEE).

## Components of the Switchboard Attestation Process

The Switchboard attestation process involves several components, including ServiceQueueAccount, NodeAccount, and QuoteAccount, which interact with each other to facilitate the attestation and verification of SGX enclaves.

### ServiceQueueAccount

ServiceQueueAccount manages the list of allowed enclave measurements (MrEnclaves) that are permitted to operate within the attestation program. It also maintains a dedicated VerifierQueue to verify the attestations associated with the ServiceQueue.

### NodeAccount

NodeAccount represents an individual SGX enclave and connects to the ServiceQueueAccount. It is associated with a PermissionAccount for access control and has a 1:N relationship with QuoteAccount, where each 'release' has its unique measurement and associated quote.

### QuoteAccount

QuoteAccount stores the attestation data (or quote) generated by the SGX enclave for a given NodeAccount. This quote contains essential information about the enclave, such as the MrEnclave measurement and the enclave's identity, which is used during the verification process.

## Attestation Lifecycle

The Switchboard Attestation Program follows a structured lifecycle to ensure the secure and trustworthy execution of code within the TEE:

1. **Create ServiceQueueAccount**: The service queue is responsible for verifying the permissions of NodeAccount.

2. **Add MrEnclave**: An acceptable MrEnclave measurement is added to the ServiceQueueAccount, representing a valid SGX enclave that is allowed to operate within the attestation program.

3. **Create NodeAccount & PermissionAccount**: A NodeAccount is created and associated with the ServiceQueueAccount, with a corresponding PermissionAccount for access control.

4. **Enable Permissions**: If necessary, permissions for the NodeAccount are enabled to allow it to interact with the ServiceQueueAccount.

5. **Create QuoteAccount**: A QuoteAccount is created on-chain for the NodeAccount, containing the attestation data generated by the SGX enclave.

6. **Verify QuoteAccount's MrEnclave Measurement**: The Switchboard Attestation Program acts as a special oracle to verify the MrEnclave measurements, ensuring that the NodeAccount's SGX measurement is still active within the ServiceQueue's allowable measurements.

7. **Allow NodeAccount to Heartbeat with QuoteAccount**: The NodeAccount is permitted to heartbeat with a given QuoteAccount, verifying that its SGX enclave is still active and trustworthy.

By following this attestation lifecycle, the Switchboard Attestation Program ensures that the SGX enclaves operating within the TEE are secure, authentic, and trustworthy. This process plays a crucial role in allowing developers to build robust and secure decentralized applications, leveraging the secure execution environment provided by SGX technology.
